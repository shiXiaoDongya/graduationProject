<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.luoxd.graduation_project.mapper.JobMapper" >

    <select id="queryClassesList" resultType="com.luoxd.graduation_project.domain.Classes">
      select classes_id,classes_name
      from classes
    </select>

    <select id="queryChildClassesListByClassesId" resultType="com.luoxd.graduation_project.domain.ChildClasses">
        select child_classes_id,child_classes_name
        from child_classes
        where classes_id = #{classesId}
    </select>

    <select id="queryJobClassesListByChildClassesId" resultType="com.luoxd.graduation_project.domain.JobClasses">
        select job_classes_id,job_classes_name,isRecommend,job_classes_url,isHot
        from job_classes
        where child_classes_id = #{childClassesId}
    </select>

    <insert id="insertToClasses" parameterType="com.luoxd.graduation_project.domain.Classes">
        insert into classes(`classes_id`,`classes_name`)
        values (#{classesId},#{classesName})
    </insert>

    <insert id="insertToChildClasses" parameterType="com.luoxd.graduation_project.domain.ChildClasses">
        insert into child_classes(`child_classes_id`,`child_classes_name`,`classes_id`)
        values (#{childClassesId},#{childClassesName},#{classesId})
    </insert>

    <insert id="insertToJobClasses" parameterType="com.luoxd.graduation_project.domain.JobClasses">
        insert into job_classes(`job_classes_id`,`job_classes_name`,`child_classes_id`)
        values (#{jobClassesId},#{jobClassesName},#{childClassesId})
    </insert>

    <update id="updateRecommendByName">
        update job_classes
        set isRecommend = 1
        where job_classes_name = #{jobClassesName}
    </update>

    <select id="queryJobList" resultType="com.luoxd.graduation_project.domain.Job" parameterType="com.luoxd.graduation_project.request.SearchRequest">
        select *
        from job
        where 1 = 1
        <if test="keyword != null and keyword != ''">
            and job_name LIKE concat('%',#{keyword},'%')
        </if>
        <if test="jobClassesId != null and jobClassesId != ''">
            and job_classes_id = #{jobClassesId}
        </if>
        <if test="expCondition != null and expCondition != ''">
            and exp_condition = #{expCondition}
        </if>
        <if test="eduCondition != null and eduCondition != ''">
            and edu_condition = #{eduCondition}
        </if>
        <if test="salCondition != null and salCondition != ''">
            <choose>
                <when test="salCondition ==1 ">
                    and salary &lt; 3000
                </when >
                <when test="salCondition ==2 ">
                    and salary &gt;= 3000 and salary &lt; 5000
                </when >
                <when test="salCondition ==3 ">
                    and salary &gt;= 5000 and salary &lt; 10000
                </when >
                <when test="salCondition ==4 ">
                    and salary &gt;= 10000 and salary &lt; 15000
                </when >
                <when test="salCondition ==5 ">
                    and salary &gt;= 15000 and salary &lt; 20000
                </when >
                <when test="salCondition ==6 ">
                    and salary &gt;= 20000 and salary &lt; 30000
                </when >
                <when test="salCondition ==7 ">
                    and salary &gt;= 30000 and salary &lt; 50000
                </when >
                <when test="salCondition ==8 ">
                    and salary &gt;= 50000
                </when >
                <otherwise>
                </otherwise>
            </choose>
        </if>
        <if test="postDateCondition != null and postDateCondition != ''">
            <choose>
                <when test="postDateCondition ==1 ">
                    and  post_date = curdate()
                </when >
                <when test="postDateCondition ==2 ">
                    and post_date &gt;  DATE_SUB(curdate, INTERVAL 3 DAY) and post_date &lt;= curdate()
                </when >
                <when test="postDateCondition ==3 ">
                    and post_date &gt; DATE_SUB(curdate, INTERVAL 7 DAY) and post_date &lt;= curdate()
                </when >
                <when test="salCondition ==4 ">
                    and post_date &gt;  DATE_SUB(curdate, INTERVAL 15 DAY) and post_date &lt;= curdate()
                </when >
                <when test="salCondition ==5 ">
                    and post_date &gt;=  DATE_SUB(curdate, INTERVAL 1 MONTH ) and post_date &lt;= curdate()
                </when >
                <otherwise>
                </otherwise>
            </choose>
        </if>
    </select>
    <select id="queryClasses" resultType="com.luoxd.graduation_project.domain.Classes">
        select *
        from classes
    </select>

    <select id="queryChildClassesByClassesId" resultType="com.luoxd.graduation_project.domain.ChildClasses">
        select *
        from child_classes
        where classes_id = #{classsesIdNum}
    </select>

    <select id="queryJobClassesByChildClassesId" resultType="com.luoxd.graduation_project.domain.JobClasses">
        select *
        from job_classes
        where child_classes_id = #{childClassesIdNum}
    </select>

    <select id="getJobById" resultType="com.luoxd.graduation_project.domain.Job">
        select *
        from job
        where job_id = #{jobId}
    </select>

    <select id="queryJsChatUsers" resultType="com.luoxd.graduation_project.response.ChatResponse">
        select recruiter.re_id,recruiter.re_realname,recruiter.re_company,recruiter.re_company_position,chat.job_id
        from chat left join recruiter on chat.re_id = recruiter.re_id
        where chat.js_id = #{userId}
        group by chat.re_id,chat.job_id
    </select>

    <select id="queryReChatUsers" resultType="com.luoxd.graduation_project.response.ChatResponse">
        select job_seeker.js_id,job_seeker.js_realname,job_seeker.js_college,chat.job_id
        from chat left join job_seeker on chat.js_id = job_seeker.js_id
        where chat.re_id = #{userId}
        group by chat.js_id,chat.job_id
    </select>

    <select id="showChatContent" resultType="com.luoxd.graduation_project.domain.Chat">
        select *
        from chat
        where js_id = #{jsId} and re_id = #{reId} and job_id = #{jobId}
    </select>
</mapper>